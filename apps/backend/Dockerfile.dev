FROM node:18-alpine

WORKDIR /app

# Instalar dependências do sistema
RUN apk add --no-cache bash openssl

# Install pnpm
RUN npm install -g pnpm

# Copiar package files
COPY apps/backend/package.json ./

# Instalar todas as dependências (incluindo dev)
RUN pnpm install

# Copiar prisma schema para gerar client
COPY apps/backend/prisma ./prisma

# Gerar Prisma Client
RUN pnpm run prisma:generate

# Criar diretórios necessários
RUN mkdir -p uploads/logos

# Expôr porta
EXPOSE 4000

# Comando padrão para desenvolvimento
CMD ["pnpm", "run", "start:dev"]