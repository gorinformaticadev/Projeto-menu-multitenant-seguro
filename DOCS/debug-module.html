<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug do Sistema Modular</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">üîç Debug do Sistema Modular</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üß™ Teste Manual do Sistema</h2>
            
            <div class="space-y-4">
                <button onclick="testModuleCore()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    1. Testar ModuleCore
                </button>
                
                <button onclick="testModuleBridge()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                    2. Testar ModuleBridge
                </button>
                
                <button onclick="testModuleLoad()" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">
                    3. Testar Carregamento do M√≥dulo
                </button>
                
                <button onclick="testFullSystem()" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    4. Testar Sistema Completo
                </button>
            </div>
            
            <div id="results" class="mt-6 p-4 bg-gray-50 rounded-lg min-h-32">
                <p class="text-gray-600">Clique nos bot√µes acima para executar os testes...</p>
            </div>
        </div>
    </div>

    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            const div = document.createElement('div');
            div.className = `${colors[type]} text-sm mb-1`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function testModuleCore() {
            clearResults();
            log('üîß Testando ModuleCore...', 'info');
            
            try {
                const response = await fetch('http://localhost:3002/api/modules/ModuleCore.js');
                log(`Status da API: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const code = await response.text();
                    log(`Tamanho do c√≥digo: ${code.length} caracteres`, 'success');
                    
                    // Executar o c√≥digo
                    const func = new Function('window', 'document', code);
                    func(window, document);
                    
                    if (window.ModuleCore) {
                        log('‚úÖ ModuleCore carregado com sucesso!', 'success');
                        log(`M√©todos dispon√≠veis: ${Object.keys(window.ModuleCore)}`, 'info');
                    } else {
                        log('‚ùå ModuleCore n√£o foi definido no window', 'error');
                    }
                } else {
                    log('‚ùå Erro ao carregar ModuleCore', 'error');
                }
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        async function testModuleBridge() {
            clearResults();
            log('üåâ Testando ModuleBridge...', 'info');
            
            try {
                // Simular o bridge (vers√£o simplificada)
                const bridge = {
                    createElement: (tag, props = {}, ...children) => {
                        const element = document.createElement(tag);
                        Object.entries(props).forEach(([key, value]) => {
                            if (key === 'className') {
                                element.className = value;
                            } else if (key.startsWith('on') && typeof value === 'function') {
                                element.addEventListener(key.slice(2).toLowerCase(), value);
                            } else {
                                element.setAttribute(key, value);
                            }
                        });
                        children.forEach(child => {
                            if (typeof child === 'string') {
                                element.appendChild(document.createTextNode(child));
                            }
                        });
                        return element;
                    },
                    showNotification: (title, message, type) => {
                        log(`üì¢ Notifica√ß√£o: ${title} - ${message} (${type})`, 'info');
                    }
                };
                
                window.ModuleBridge = bridge;
                log('‚úÖ ModuleBridge simulado criado', 'success');
                
                // Testar createElement
                const testElement = bridge.createElement('div', { className: 'test-class' }, 'Teste');
                log(`‚úÖ createElement funcionando: ${testElement.tagName}`, 'success');
                
                // Testar notifica√ß√£o
                bridge.showNotification('Teste', 'Mensagem de teste', 'info');
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        async function testModuleLoad() {
            clearResults();
            log('üì¶ Testando carregamento do m√≥dulo...', 'info');
            
            try {
                const response = await fetch('http://localhost:3002/api/modules/module-exemplo/frontend/pages/index.js');
                log(`Status da API: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const code = await response.text();
                    log(`Tamanho do c√≥digo: ${code.length} caracteres`, 'success');
                    
                    // Verificar se √© JavaScript v√°lido
                    if (code.includes('function ModuleExemploPage')) {
                        log('‚úÖ Fun√ß√£o ModuleExemploPage encontrada', 'success');
                    } else {
                        log('‚ùå Fun√ß√£o ModuleExemploPage n√£o encontrada', 'error');
                    }
                    
                    // Executar o c√≥digo
                    const func = new Function('window', 'document', 'ModuleBridge', code);
                    func(window, document, window.ModuleBridge);
                    
                    if (window.ModuleExemploPage) {
                        log('‚úÖ ModuleExemploPage carregado com sucesso!', 'success');
                        
                        // Testar instancia√ß√£o
                        const instance = window.ModuleExemploPage();
                        if (instance && typeof instance.render === 'function') {
                            log('‚úÖ Inst√¢ncia criada e m√©todo render dispon√≠vel', 'success');
                        } else {
                            log('‚ùå Problema na instancia√ß√£o ou m√©todo render', 'error');
                        }
                    } else {
                        log('‚ùå ModuleExemploPage n√£o foi definido no window', 'error');
                    }
                } else {
                    log('‚ùå Erro ao carregar m√≥dulo', 'error');
                }
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        async function testFullSystem() {
            clearResults();
            log('üöÄ Testando sistema completo...', 'info');
            
            try {
                // 1. Carregar ModuleCore
                await testModuleCore();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 2. Configurar Bridge
                log('üåâ Configurando bridge...', 'info');
                await testModuleBridge();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 3. Carregar m√≥dulo
                log('üì¶ Carregando m√≥dulo...', 'info');
                await testModuleLoad();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 4. Renderizar
                if (window.ModuleExemploPage) {
                    log('üé® Tentando renderizar...', 'info');
                    
                    const instance = window.ModuleExemploPage();
                    const rendered = instance.render();
                    
                    if (rendered) {
                        log('‚úÖ M√≥dulo renderizado com sucesso!', 'success');
                        
                        // Adicionar √† p√°gina para visualiza√ß√£o
                        const container = document.createElement('div');
                        container.className = 'mt-6 border-2 border-green-200 rounded-lg p-4';
                        container.appendChild(rendered);
                        results.parentElement.appendChild(container);
                        
                        log('‚úÖ M√≥dulo adicionado √† p√°gina para visualiza√ß√£o', 'success');
                    } else {
                        log('‚ùå Falha na renderiza√ß√£o', 'error');
                    }
                } else {
                    log('‚ùå ModuleExemploPage n√£o dispon√≠vel', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Erro no sistema completo: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>