# Exemplo de configuração nginx para one-command installation

# Arquivo: /etc/nginx/sites-available/get.seudominio.com.br

upstream install_backend {
    server 127.0.0.1:8080;
}

# Rate limiting para evitar abusos
limit_req_zone $binary_remote_addr zone=install_limit:10m rate=10r/m;
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/m;

server {
    listen 80;
    server_name get.seudominio.com.br;
    
    # Redirecionar todo tráfego HTTP para HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name get.seudominio.com.br;
    
    # Configuração SSL (ajuste conforme seus certificados)
    ssl_certificate /etc/letsencrypt/live/get.seudominio.com.br/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/get.seudominio.com.br/privkey.pem;
    
    # Configurações de segurança SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # Headers de segurança
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Localização principal - serve o script de instalação
    location / {
        limit_req zone=install_limit burst=20 nodelay;
        
        # Caminho para o script de instalação
        alias /var/www/scripts/install-one-command.sh;
        
        # Configurações para servir o script
        default_type text/plain;
        add_header Content-Type text/plain;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma no-cache;
        add_header Expires 0;
        
        # Logging detalhado para monitoramento
        access_log /var/log/nginx/install.access.log combined;
        error_log /var/log/nginx/install.error.log;
    }
    
    # Endpoint para verificar status do serviço
    location /status {
        limit_req zone=api_limit burst=50;
        
        # Resposta simples indicando que o serviço está online
        add_header Content-Type application/json;
        return 200 '{"status":"online","service":"one-command-install","timestamp":"$time_iso8601"}';
    }
    
    # Endpoint para versão do script
    location /version {
        limit_req zone=api_limit burst=50;
        
        add_header Content-Type text/plain;
        return 200 '1.0.0';
    }
    
    # Bloquear acesso a arquivos sensíveis
    location ~ /\. {
        deny all;
        return 404;
    }
    
    location ~ \.(sh|bash|conf)$ {
        deny all;
        return 404;
    }
}

# Configuração adicional para monitoramento
server {
    listen 127.0.0.1:8080;
    server_name localhost;
    
    # Endpoint para métricas do sistema
    location /metrics {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        deny all;
    }
    
    # Health check
    location /health {
        return 200 '{"status":"healthy","service":"nginx"}';
        add_header Content-Type application/json;
    }
}# Exemplo de configuração nginx para one-command installation

# Arquivo: /etc/nginx/sites-available/get.seudominio.com.br

upstream install_backend {
    server 127.0.0.1:8080;
}

# Rate limiting para evitar abusos
limit_req_zone $binary_remote_addr zone=install_limit:10m rate=10r/m;
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/m;

server {
    listen 80;
    server_name get.seudominio.com.br;
    
    # Redirecionar todo tráfego HTTP para HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name get.seudominio.com.br;
    
    # Configuração SSL (ajuste conforme seus certificados)
    ssl_certificate /etc/letsencrypt/live/get.seudominio.com.br/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/get.seudominio.com.br/privkey.pem;
    
    # Configurações de segurança SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # Headers de segurança
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Localização principal - serve o script de instalação
    location / {
        limit_req zone=install_limit burst=20 nodelay;
        
        # Caminho para o script de instalação
        alias /var/www/scripts/install-one-command.sh;
        
        # Configurações para servir o script
        default_type text/plain;
        add_header Content-Type text/plain;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma no-cache;
        add_header Expires 0;
        
        # Logging detalhado para monitoramento
        access_log /var/log/nginx/install.access.log combined;
        error_log /var/log/nginx/install.error.log;
    }
    
    # Endpoint para verificar status do serviço
    location /status {
        limit_req zone=api_limit burst=50;
        
        # Resposta simples indicando que o serviço está online
        add_header Content-Type application/json;
        return 200 '{"status":"online","service":"one-command-install","timestamp":"$time_iso8601"}';
    }
    
    # Endpoint para versão do script
    location /version {
        limit_req zone=api_limit burst=50;
        
        add_header Content-Type text/plain;
        return 200 '1.0.0';
    }
    
    # Bloquear acesso a arquivos sensíveis
    location ~ /\. {
        deny all;
        return 404;
    }
    
    location ~ \.(sh|bash|conf)$ {
        deny all;
        return 404;
    }
}

# Configuração adicional para monitoramento
server {
    listen 127.0.0.1:8080;
    server_name localhost;
    
    # Endpoint para métricas do sistema
    location /metrics {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        deny all;
    }
    
    # Health check
    location /health {
        return 200 '{"status":"healthy","service":"nginx"}';
        add_header Content-Type application/json;
    }
}